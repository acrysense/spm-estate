"use strict";

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
document.addEventListener('DOMContentLoaded', function () {
  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // slim select
  var allSelect = document.querySelectorAll('.js-select');
  if (allSelect) {
    allSelect.forEach(function (item) {
      new SlimSelect({
        select: item
      });
    });
  }

  // range
  var rangeSliders = document.querySelectorAll('.new-stats-data__range-slider');
  if (rangeSliders) {
    rangeSliders.forEach(function (slider) {
      var parent = slider.closest('.new-stats-data__range');
      var inputs = [parent.querySelector('.range-field__input--min'), parent.querySelector('.range-field__input--max')];
      noUiSlider.create(slider, {
        start: [Number(slider.dataset.rangeStart), Number(slider.dataset.rangeEnd)],
        connect: true,
        range: {
          'min': Number(slider.dataset.rangeMin),
          'max': Number(slider.dataset.rangeMax)
        }
      });
      slider.noUiSlider.on('update', function (values, handle) {
        inputs[handle].value = Number(values[handle]).toFixed();
      });
      inputs.forEach(function (input, handle) {
        input.addEventListener('change', function () {
          slider.noUiSlider.setHandle(handle, Number(this.value).toFixed());
        });
        input.addEventListener('keydown', function (e) {
          var values = slider.noUiSlider.get();
          var value = Number(values[handle]);

          // [[handle0_down, handle0_up], [handle1_down, handle1_up]]
          var steps = slider.noUiSlider.steps();

          // [down, up]
          var step = steps[handle];
          var position;

          // 13 is enter,
          // 38 is key up,
          // 40 is key down.
          switch (e.which) {
            case 13:
              slider.noUiSlider.setHandle(handle, Number(this.value).toFixed());
              break;
            case 38:
              // Get step to go increase slider value (up)
              position = step[1];

              // false = no step is set
              if (position === false) {
                position = 1;
              }

              // null = edge of slider
              if (position !== null) {
                slider.noUiSlider.setHandle(handle, Number(value + position).toFixed());
              }
              break;
            case 40:
              position = step[0];
              if (position === false) {
                position = 1;
              }
              if (position !== null) {
                slider.noUiSlider.setHandle(handle, Number(value - position).toFixed());
              }
              break;
          }
        });
      });
    });
  }

  // new stats tabs
  var newStatsTabsItem = document.querySelectorAll('.new-stats-tabs__item');
  if (newStatsTabsItem) {
    newStatsTabsItem.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.new-stats-tabs');
        parent.querySelectorAll('.new-stats-tabs__item').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        parent.querySelectorAll('.new-stats-tabs__wrapper').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        item.classList.add('is--active');
        var el = parent.querySelector('.is--active');
        var index = _toConsumableArray(parent.querySelectorAll('.new-stats-tabs__item')).indexOf(el);
        parent.querySelectorAll('.new-stats-tabs__wrapper')[index].classList.add('is--active');
      });
    });
  }

  // chart
  var gymData = {
    labels: ['со спортзалом', 'без спортзала'],
    datasets: [{
      label: 'Спортзалы в объектах',
      data: [8000, 2000],
      backgroundColor: ['#EE98BA', '#CCDAF5'],
      borderWidth: 0
    }]
  };
  var swimmingPoolsData = {
    labels: ['с бассейном', 'без бассейна'],
    datasets: [{
      label: 'Бассейны в объектах',
      data: [6000, 4000],
      backgroundColor: ['#799EE5', '#CCDAF5'],
      borderWidth: 0
    }]
  };
  var typeNewEstateData = {
    labels: ['виллы', 'апартаменты', 'semi-detached villas', 'таунхаусы', 'офисы', 'магазины', 'кафе и рестораны'],
    datasets: [{
      label: 'Типы новой недвижимости',
      data: [3500, 2100, 1600, 1200, 1200, 400, 400],
      backgroundColor: ['#799EE5', '#EE98BA', '#9DDFE0', '#AAA7F8', '#FFD27B', '#B1DD74', '#E6EDFA'],
      borderWidth: 0
    }]
  };
  var typeSellEstateData = {
    labels: ['виллы', 'апартаменты', 'semi-detached villas', 'таунхаусы', 'офисы', 'магазины', 'кафе и рестораны'],
    datasets: [{
      label: 'Типы новой недвижимости',
      data: [3500, 2100, 1600, 1200, 1200, 400, 400],
      backgroundColor: ['#799EE5', '#EE98BA', '#9DDFE0', '#AAA7F8', '#FFD27B', '#B1DD74', '#E6EDFA'],
      borderWidth: 0
    }]
  };
  var forecastsData = {
    labels: ['виллы', 'апартаменты', 'semi-detached villas', 'таунхаусы', 'офисы', 'магазины', 'кафе и рестораны'],
    datasets: [{
      label: 'Типы новой недвижимости',
      data: [3500, 2100, 1600, 1200, 1200, 400, 400],
      backgroundColor: ['#799EE5', '#EE98BA', '#9DDFE0', '#AAA7F8', '#FFD27B', '#B1DD74', '#E6EDFA'],
      borderWidth: 0
    }]
  };
  var options = {
    plugins: {
      legend: {
        display: false
      }
    }
  };
  var optionsBar = {
    plugins: {
      legend: {
        display: false
      }
    }
  };
  var gymsChart = document.getElementById('gyms-facilities');
  var swimmingPoolsChart = document.getElementById('swimming-pools-facilities');
  var typeNewEstateChart = document.getElementById('type-new-estate');
  var typeSellEstateChart = document.getElementById('type-sell-estate');
  var forecastChart = document.getElementById('forecasts');
  var myGymsChart = new Chart(gymsChart, {
    type: 'pie',
    data: gymData,
    options: options,
    plugins: [{
      beforeInit: function beforeInit(chart, args, options) {
        if (chart.canvas.id === chart.ctx.canvas.id) {
          var ul = document.createElement('ul');
          chart.data.labels.forEach(function (label, i) {
            ul.innerHTML += "\n                <li class=\"legend-item\">\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-color\" style=\"background-color: ".concat(chart.data.datasets[0].backgroundColor[i], "\"></span>\n                    <span class=\"legend-title\">").concat(label, "</span>\n                  </div>\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-value\">").concat(chart.data.datasets[0].data[i], "</span>\n                  </div>\n                </li>\n              ");
          });
          return document.getElementById('gyms-legend').appendChild(ul);
        }
        return;
      }
    }]
  });
  var mySwimmingPoolsChart = new Chart(swimmingPoolsChart, {
    type: 'pie',
    data: swimmingPoolsData,
    options: options,
    plugins: [{
      beforeInit: function beforeInit(chart, args, options) {
        if (chart.canvas.id === chart.ctx.canvas.id) {
          var ul = document.createElement('ul');
          chart.data.labels.forEach(function (label, i) {
            ul.innerHTML += "\n                <li class=\"legend-item\">\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-color\" style=\"background-color: ".concat(chart.data.datasets[0].backgroundColor[i], "\"></span>\n                    <span class=\"legend-title\">").concat(label, "</span>\n                  </div>\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-value\">").concat(chart.data.datasets[0].data[i], "</span>\n                  </div>\n                </li>\n              ");
          });
          return document.getElementById('swimming-pools-legend').appendChild(ul);
        }
        return;
      }
    }]
  });
  var myTypeNewEstateChart = new Chart(typeNewEstateChart, {
    type: 'pie',
    data: typeNewEstateData,
    options: options,
    plugins: [{
      beforeInit: function beforeInit(chart, args, options) {
        if (chart.canvas.id === chart.ctx.canvas.id) {
          var ul = document.createElement('ul');
          chart.data.labels.forEach(function (label, i) {
            ul.innerHTML += "\n                <li class=\"legend-item\">\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-color\" style=\"background-color: ".concat(chart.data.datasets[0].backgroundColor[i], "\"></span>\n                    <span class=\"legend-title\">").concat(label, "</span>\n                  </div>\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-value\">").concat(chart.data.datasets[0].data[i], "</span>\n                  </div>\n                </li>\n              ");
          });
          return document.getElementById('type-new-estate-legend').appendChild(ul);
        }
        return;
      }
    }]
  });
  var myTypeSellEstateChart = new Chart(typeSellEstateChart, {
    type: 'pie',
    data: typeSellEstateData,
    options: options,
    plugins: [{
      beforeInit: function beforeInit(chart, args, options) {
        if (chart.canvas.id === chart.ctx.canvas.id) {
          var ul = document.createElement('ul');
          chart.data.labels.forEach(function (label, i) {
            ul.innerHTML += "\n                <li class=\"legend-item\">\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-color\" style=\"background-color: ".concat(chart.data.datasets[0].backgroundColor[i], "\"></span>\n                    <span class=\"legend-title\">").concat(label, "</span>\n                  </div>\n                  <div class=\"legend-inner\">\n                    <span class=\"legend-value\">").concat(chart.data.datasets[0].data[i], "</span>\n                  </div>\n                </li>\n              ");
          });
          return document.getElementById('type-sell-estate-legend').appendChild(ul);
        }
        return;
      }
    }]
  });

  // const myForecast = new Chart(forecastChart, {
  //   type: 'bar',
  //   data: forecastsData,
  //   options: optionsBar,
  // });
});